#!/bin/bash

CHANNEL_URL="https://www.youtube.com/@LukeSmithxyz/videos"
DATA_FILE="$HOME/.cache/lukesmithyt.tsv"

[ ! -f "$DATA_FILE" ] && yt-dlp -j --flat-playlist --skip-download "$CHANNEL_URL" | jq -r '[.title, .id] | @tsv' > "$DATA_FILE"

[ "$(echo -e "No\nYes" | dmenu -i -l 2 -p "Update?")" == "Yes" ] && yt-dlp -j --flat-playlist --skip-download "$CHANNEL_URL" | jq -r '[.title, .id] | @tsv' > "$DATA_FILE"

video_info=$(cat "$DATA_FILE")

selected_title=$(echo "$video_info" | cut -f1 | dmenu -i -l 20 -p "Video:")

[ -n "$selected_title" ] && mpv "https://www.youtube.com/watch?v=$(echo "$video_info" | grep -Fw "$selected_title" | cut -f2)"
