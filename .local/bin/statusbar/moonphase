#!/bin/sh

# Shows the current moon phase.

moonfile="${XDG_DATA_HOME:-$HOME/.local/share}/moonphase"

[ "$(stat -c %y "$moonfile" 2>/dev/null | cut -d' ' -f1)" = "$(date '+%Y-%m-%d')" ] ||
	{ curl -sf "wttr.in/?format=%m" > "$moonfile" || exit 1 ;}

icon="$(cat "$moonfile")"

case "$icon" in
	ğŸŒ‘) name="New" ;;
	ğŸŒ’) name="Waxing Crescent" ;;
	ğŸŒ“) name="First Quarter" ;;
	ğŸŒ”) name="Waxing Gibbous" ;;
	ğŸŒ•) name="Full" ;;
	ğŸŒ–) name="Waning Gibbous" ;;
	ğŸŒ—) name="Last Quarter" ;;
	ğŸŒ˜) name="Waning Crescent" ;;
	*) exit 1 ;;
esac

icon="$(ico $icon)" || icon="?"
echo "$icon"

case $BLOCK_BUTTON in
	3) notify-send "$(ico ğŸŒ˜) Moon phase module" "Displays current moon phase.
- $(ico ğŸŒ‘): New
- $(ico ğŸŒ’): Waxing Crescent
- $(ico ğŸŒ“): First Quarter
- $(ico ğŸŒ”): Waxing Gibbous
- $(ico ğŸŒ•): Full
- $(ico ğŸŒ–): Waning Gibbous
- $(ico ğŸŒ—): Last Quarter
- $(ico ğŸŒ˜): Waning Crescent" ;;
	6) "$TERMINAL" -e "$EDITOR" "$0" ;;
esac
