#!/bin/sh

# Shows the current moon phase.

moonfile="${XDG_DATA_HOME:-$HOME/.local/share}/moonphase"

[ "$(stat -c %y "$moonfile" 2>/dev/null | cut -d' ' -f1)" = "$(date '+%Y-%m-%d')" ] ||
	{ curl -sf 'https://www.timeanddate.com/moon/phases/' | grep -m1 -o cur-moon-percent.......................................................................................................................................................... > "$moonfile" || exit 1 ;}

mnphs=$( cat $moonfile | grep -o 'New\|Waxing Crescent\|First Quarter\|Waxing Gibbous\|Full\|Waning Gibbous\|Last Quarter\|Waning Crescent' | grep -m1 '.')
prcnt=$( cat $moonfile | grep -o "[0-9.0-9]*%" | grep -o "[0-9.0-9]*" )
case "$mnphs" in
	"New") icon="ðŸŒ‘" prcnt="0" ;;
	"Waxing Crescent") icon="ðŸŒ’" ;;
	"First Quarter") icon="ðŸŒ“" prcnt="50" ;;
	"Waxing Gibbous") icon="ðŸŒ”" ;;
	"Full") icon="ðŸŒ•" prcnt="100" ;;
	"Waning Gibbous") icon="ðŸŒ–" ;;
	"Last Quarter") icon="ðŸŒ—" prcnt="50" ;;
	"Waning Crescent") icon="ðŸŒ˜" ;;
	*) echo exit 1 ;;
esac

echo ""$icon" "$prcnt"%"

case $BLOCK_BUTTON in
	3) notify-send "ðŸŒœ Moon phase module" "$icon: $mnphs $prcnt" ;;
	6) "$TERMINAL" -e "$EDITOR" "$0" ;;
esac
